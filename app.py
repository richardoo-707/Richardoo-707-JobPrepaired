"""
Gradio Web åº”ç”¨ - å¤š Agent èŒä¸šè§„åˆ’ç³»ç»Ÿ

å°† autojob_v2.py çš„ CLI åº”ç”¨è½¬æ¢ä¸ºåŸºäº Gradio çš„ Web ç•Œé¢ã€‚
ç”¨æˆ·å¯ä»¥é€šè¿‡ Web ç•Œé¢ä¸Šä¼ ç®€å†ï¼Œç³»ç»Ÿä¼šè‡ªåŠ¨ç”ŸæˆèŒä¸šè§„åˆ’æŠ¥å‘Šã€‚
"""

import os
import gradio as gr
from autojob_v2 import manager_agent


def build_sop_prompt(resume_path: str) -> str:
    """
    æ„å»ºæ ‡å‡†ä½œä¸šç¨‹åº (SOP) Prompt
    
    Args:
        resume_path: ç®€å†æ–‡ä»¶è·¯å¾„
        
    Returns:
        å®Œæ•´çš„ SOP Prompt å­—ç¬¦ä¸²
    """
    prompt = f"""
    æˆ‘ä¸Šä¼ äº†ç®€å† '{resume_path}'ã€‚è¯·ä¸¥æ ¼æŒ‰ç…§ä»¥ä¸‹æµç¨‹æ‰§è¡Œï¼Œå¹¶è¿›è¡Œè´¨é‡æŠŠæ§ï¼š
    
    ========== ç¬¬ä¸€é˜¶æ®µï¼šå¸‚åœºå®šä½ (Analyst) ==========
    
    è°ƒç”¨ industry_analyst å·¥å…·ï¼Œè¦æ±‚ï¼š
    1. ä½¿ç”¨ read_resume_tool è¯»å–ç®€å†æ–‡ä»¶ '{resume_path}'ï¼Œåˆ†æç”¨æˆ·èƒŒæ™¯å’ŒæŠ€èƒ½
    2. ä»ç®€å†ä¸­æå–ç”¨æˆ·æ ‡ç­¾ (user_tags)ï¼ŒåŒ…æ‹¬ï¼š
       - æ•™è‚²èƒŒæ™¯ï¼š985/211/åŒéã€æœ¬ç§‘/ç¡•å£«/åšå£«
       - ä¸“ä¸šèƒŒæ™¯ï¼šè®¡ç®—æœº/éè®¡ç®—æœº/è½¬ç 
       - å…¶ä»–æ ‡ç­¾ï¼šæµ·å¤–ç•™å­¦ã€å·¥ä½œç»éªŒç­‰
    3. ä½¿ç”¨ analyze_market_match_tool(user_tags) æœç´¢ç‰›å®¢ç½‘å’ŒçŸ¥ä¹ï¼Œ
       æŸ¥æ‰¾å…·æœ‰ç›¸ä¼¼èƒŒæ™¯æ ‡ç­¾çš„å€™é€‰äººå®é™…æ‹¿åˆ° offer çš„å…¬å¸
    4. åŸºäºæœç´¢ç»“æœï¼Œæ¨è 5 å®¶**çœŸå®å¯è¾¾æˆçš„**ç›®æ ‡å…¬å¸
    
    ã€å®¡æ ¸ç‚¹ - å¿…é¡»ä¸¥æ ¼æ£€æŸ¥ã€‘ï¼š
    - å¦‚æœè¿”å›çš„å…¬å¸å…¨æ˜¯ Google/Microsoft/Apple è¿™ç§æ³›æ³›çš„å¤§å‚ä¸”æ²¡æœ‰å…·ä½“ç†ç”±ï¼Œ**å¿…é¡»è¦æ±‚é‡è¯•**
    - å¦‚æœæ¨èçš„å…¬å¸å°‘äº 5 å®¶ï¼Œ**å¿…é¡»è¦æ±‚é‡è¯•**
    - å¿…é¡»åŸºäºç‰›å®¢ç½‘/çŸ¥ä¹çš„çœŸå®æ•°æ®ï¼Œä¸èƒ½å‡­ç©ºæƒ³è±¡
    
    åªæœ‰é€šè¿‡å®¡æ ¸ï¼ˆ5å®¶å…¬å¸ã€åŠ¡å®é€‰æ‹©ã€åŸºäºçœŸå®æ•°æ®ï¼‰æ‰èƒ½è¿›å…¥ä¸‹ä¸€é˜¶æ®µã€‚
    
    ========== ç¬¬äºŒé˜¶æ®µï¼šèŒä½çŒå– (Headhunter) ==========
    
    è°ƒç”¨ job_headhunter å·¥å…·ï¼Œè¦æ±‚ï¼š
    é’ˆå¯¹ç¬¬ä¸€é˜¶æ®µé€šè¿‡å®¡æ ¸çš„ 5 å®¶å…¬å¸ï¼Œæ‰§è¡Œä»¥ä¸‹æ­¥éª¤ï¼š
    
    æ­¥éª¤ 2.1 (æ£€æŸ¥æœ¬åœ°ç¼“å­˜):
    - ä»ç®€å†ä¸­æå– 3-5 ä¸ªå…³é”®è¯æ ‡ç­¾ï¼ˆä¾‹å¦‚ï¼š"Python"ã€"Java"ã€"Shanghai"ã€"Intern"ã€"AI" ç­‰ï¼‰
    - ä½¿ç”¨ query_local_db_tool(tags) æŸ¥è¯¢æœ¬åœ°æ•°æ®åº“
    
    æ­¥éª¤ 2.2 (å†³ç­–):
    - å¦‚æœæœ¬åœ°æ•°æ®åº“è¿”å›äº†æœ‰ç”¨çš„ JD ä¿¡æ¯ï¼šç›´æ¥ä½¿ç”¨è¿™äº›ç¼“å­˜çš„ JDï¼Œè·³è¿‡åœ¨çº¿æœç´¢
    - å¦‚æœæœ¬åœ°æ•°æ®åº“æ²¡æœ‰è¿”å›ç»“æœï¼Œæˆ–è€…è¿”å›çš„ JD ä¸ç›¸å…³/è¿‡æ—¶ï¼š
      * ä½¿ç”¨ search_jd_tool æœç´¢è¿™ 5  å®¶å…¬å¸çš„æœ€è¿‘ä¸ç”¨æˆ·ç›¸å…³å²—ä½æˆ–ç›¸å…³èŒä½ JD
      * å¯¹äºæ¯ä¸ªæ‰¾åˆ°çš„ JD URLï¼Œä½¿ç”¨ visit_page_tool è®¿é—®å¹¶æå–å®Œæ•´çš„èŒä½æè¿°å†…å®¹
    
    æ­¥éª¤ 2.3 (ç¼“å­˜æ–°æ•°æ®):
    - å¦‚æœè¿›è¡Œäº†åœ¨çº¿æœç´¢å¹¶æ‰¾åˆ°äº†å¥½çš„ JDï¼ˆåŒ…å«å®Œæ•´ä¿¡æ¯ã€ç›¸å…³æ€§å¼ºï¼‰ï¼Œ
      ä½¿ç”¨ save_to_db_tool å°†è¿™äº› JD ä¿å­˜åˆ°æœ¬åœ°æ•°æ®åº“
    
    ã€å®¡æ ¸ç‚¹ - å¿…é¡»ä¸¥æ ¼æ£€æŸ¥ã€‘ï¼š
    - **è–ªèµ„æ£€æŸ¥**ï¼šå¦‚æœè–ªèµ„æ˜¯ 'é¢è®®'ã€'Negotiable'ã€'Unknown' æˆ–ç¼ºå¤±ï¼Œ**å¿…é¡»è¦æ±‚é‡è¯•**
      * è¦æ±‚å®ƒæ ¹æ®å†…éƒ¨çŸ¥è¯†æˆ–å¸‚åœºæ•°æ®ä¼°ç®—ä¸€ä¸ªå‚è€ƒèŒƒå›´ï¼ˆæ ¼å¼ï¼šå¸‚åœºå‚è€ƒ: XXk-XXk/æœˆï¼‰
      * ç»å¯¹ä¸èƒ½ç•™ç©ºè–ªèµ„ä¿¡æ¯
    - **åœ°ç‚¹æ£€æŸ¥**ï¼šå¦‚æœç¼ºå°‘ Base åœ°ç‚¹æˆ–åœ°ç‚¹æ˜¯ 'å¾…å®š'ã€'TBD'ï¼Œ**å¿…é¡»è¦æ±‚é‡è¯•**
      * å¿…é¡»æä¾›å…·ä½“åœ°ç‚¹ï¼ˆå¦‚ "åŒ—äº¬"ã€"ä¸Šæµ·"ã€"Singapore"ã€"è¿œç¨‹"ï¼‰
      * å¦‚æœ JD ä¸­æ²¡æœ‰æ˜ç¡®åœ°ç‚¹ï¼Œè¦æ±‚ä» JD å†…å®¹æ¨æ–­æˆ–ä½¿ç”¨ "å¾…ç¡®è®¤"
    - **å²—ä½æ£€æŸ¥**ï¼šå¦‚æœå²—ä½å’Œå…¶ä¸“ä¸šä¸æ˜¯ç›¸å…³ï¼Œ**å¿…é¡»è¦æ±‚é‡è¯•**
      * ä¾‹å¦‚æ˜¯è´¢ç»å²—ä½æ›´ç¬¦åˆéœ€æ±‚ï¼Œä½†å´æ¨èaiå²—ä½åˆ™æ‰“å›ã€‚
    åªæœ‰é€šè¿‡å®¡æ ¸ï¼ˆè–ªèµ„å’Œåœ°ç‚¹å’Œå²—ä½éƒ½å®Œæ•´ï¼‰æ‰èƒ½è¿›å…¥ä¸‹ä¸€é˜¶æ®µã€‚
    
    ========== ç¬¬ä¸‰é˜¶æ®µï¼šæŠ€èƒ½å·®è· (Coach) ==========
    
    è°ƒç”¨ career_coach å·¥å…·ï¼Œè¦æ±‚ï¼š
    1. å¯¹æ¯” JD è¦æ±‚å’Œç®€å†æŠ€èƒ½ï¼Œåˆ†ææŠ€èƒ½å·®è·ï¼Œå‘Šè¯‰æˆ‘ç¼ºä»€ä¹ˆæŠ€èƒ½
    2. å¯¹äºç¼ºå¤±çš„æŠ€èƒ½ï¼Œä½¿ç”¨ search_github_tool æœç´¢ç›¸å…³çš„å­¦ä¹ èµ„æºå’Œé¡¹ç›®ï¼Œæ¨è GitHub ä»“åº“
    
    ã€å®¡æ ¸ç‚¹ - å¿…é¡»ä¸¥æ ¼æ£€æŸ¥ã€‘ï¼š
    - å¦‚æœæ¨èçš„æ˜¯ 'å­¦ä¹  Python'ã€'å­¦ä¹ æœºå™¨å­¦ä¹ ' è¿™ç§æ³›æ³›çš„å»ºè®®ï¼Œ**å¿…é¡»æ‰“å›é‡åš**
    - å¿…é¡»æ¨èå…·ä½“çš„ GitHub ä»“åº“é“¾æ¥ï¼Œæ ¼å¼ä¸ºï¼šowner/repoï¼ˆä¾‹å¦‚ï¼šlangchain-ai/langchainï¼‰
    - æ¯ä¸ªæ¨èå¿…é¡»åŒ…å«å®Œæ•´çš„ä»“åº“åç§°å’Œé“¾æ¥
    - ä¸èƒ½æ˜¯æŠ½è±¡çš„å­¦ä¹ å»ºè®®ï¼Œå¿…é¡»æ˜¯å…·ä½“çš„å¯è®¿é—®çš„é¡¹ç›®
    
    åªæœ‰é€šè¿‡å®¡æ ¸ï¼ˆæ¨èçš„æ˜¯å…·ä½“ GitHub ä»“åº“é“¾æ¥ï¼‰æ‰èƒ½è¿›å…¥ä¸‹ä¸€é˜¶æ®µã€‚
    
    ========== ç¬¬å››é˜¶æ®µï¼šæœ€ç»ˆæŠ¥å‘Š (Manager) ==========
    
    æ±‡æ€»æ‰€æœ‰é€šè¿‡å®¡æ ¸çš„é«˜è´¨é‡æ•°æ®ï¼Œæ‰§è¡Œä»¥ä¸‹ä»»åŠ¡ï¼š
    
    1. ç¼–è¯‘ä¸€ä»½ç»¼åˆæ‘˜è¦æŠ¥å‘Šï¼ŒåŒ…å«ä»¥ä¸‹å†…å®¹ï¼š
       - **èŒä½å¯¹æ¯”è¡¨**ï¼ˆå¿…é¡»åŒ…å«ï¼Œè§ä¸‹æ–¹æ ¼å¼è¦æ±‚ï¼‰
       - ä» JD ä¸­æå–çš„å…³é”®è¦æ±‚ï¼ˆè¯¦ç»†è¯´æ˜ï¼‰
       - æˆ‘çš„æŠ€èƒ½å·®è·åˆ†æï¼ˆæˆ‘å·²æœ‰çš„æŠ€èƒ½ vs. éœ€è¦çš„æŠ€èƒ½ï¼‰
       - æ¨èçš„ GitHub å­¦ä¹ é¡¹ç›®ï¼ˆé¡¹ç›®åç§° + é“¾æ¥ï¼‰
    
    2. **èŒä½å¯¹æ¯”è¡¨æ ¼å¼è¦æ±‚ï¼ˆå¿…é¡»ä¸¥æ ¼éµå®ˆï¼‰**ï¼š
       è¡¨æ ¼å¿…é¡»åŒ…å«ä»¥ä¸‹åˆ—ï¼š
       `| å…¬å¸åç§° | èŒä½åç§° | Base (åœ°ç‚¹) | é¢„ä¼°è–ªèµ„ | æ ¸å¿ƒè¦æ±‚ (ç®€è¿°) |`
       
       **è–ªèµ„å¤„ç†é€»è¾‘ï¼ˆé‡è¦ï¼‰**ï¼š
       - å¦‚æœ JD ä¸­æ˜ç¡®åŒ…å«è–ªèµ„èŒƒå›´ï¼Œç›´æ¥ä½¿ç”¨ï¼ˆå¦‚ "25k-40k/æœˆ"ï¼‰
       - å¦‚æœ JD æ˜¾ç¤º "é¢è®®"ã€"Negotiable" æˆ–éšè—è–ªèµ„ä¿¡æ¯ï¼Œå¿…é¡»ä½¿ç”¨å¸‚åœºå‚è€ƒæ ¼å¼
       - **ç»å¯¹ä¸èƒ½ç•™ç©º**ï¼Œå¿…é¡»æä¾›è–ªèµ„ä¿¡æ¯ï¼ˆå³ä½¿æ˜¯å¸‚åœºå‚è€ƒå€¼ï¼‰
       
       **åœ°ç‚¹å¤„ç†é€»è¾‘**ï¼š
       - Base Location å¿…é¡»æ˜¯å…·ä½“åœ°ç‚¹ï¼ˆå¦‚ "åŒ—äº¬"ã€"ä¸Šæµ·"ã€"Singapore"ã€"è¿œç¨‹"ï¼‰
       - ä¸èƒ½ä½¿ç”¨æ¨¡ç³Šè¡¨è¿°ï¼ˆå¦‚ "å¾…å®š"ã€"TBD"ï¼‰
       
       **ç¤ºä¾‹è¡¨æ ¼è¡Œ**ï¼š
       | ByteDance | AI Engineer | åŒ—äº¬ | 25k-40k/æœˆ | Python, PyTorch, K8s |
       | Shopee | Machine Learning Engineer | æ–°åŠ å¡ | å¸‚åœºå‚è€ƒ: 20k-30k/æœˆ | TensorFlow, AWS, Docker |
       | ç¾å›¢ | AIç®—æ³•å·¥ç¨‹å¸ˆ | ä¸Šæµ· | é¢è®® (å¸‚åœºå‚è€ƒ: 22k-35k/æœˆ) | Python, Spark, æ¨èç³»ç»Ÿ |
    
    3. å°†è¿™ä»½æŠ¥å‘Šæ ¼å¼åŒ–ä¸ºæ¸…æ™°çš„ Markdown æ–‡æ¡£ï¼Œç¡®ä¿èŒä½å¯¹æ¯”è¡¨æ ¼å¼æ­£ç¡®
    4. **è¯­è¨€å¿…é¡»æ˜¯ç®€ä½“ä¸­æ–‡**ï¼ˆå³ä½¿ JD å’Œ GitHub æ˜¯è‹±æ–‡ï¼Œä¹Ÿè¦ç¿»è¯‘æˆä¸­æ–‡æ€»ç»“ï¼‰
    5. ä½¿ç”¨ save_report_tool å°†å†…å®¹ä¿å­˜åˆ°æ–‡ä»¶ 'my_career_plan_v2.md'
    6. å‘Šè¯‰ç”¨æˆ·æ–‡ä»¶å·²ç”Ÿæˆ
    
    ========== é‡è¦æé†’ ==========
    
    ä½œä¸ºè´¨é‡å®¡æ ¸å‘˜ï¼Œä½ å¿…é¡»ï¼š
    - åœ¨æ¯ä¸ªé˜¶æ®µç»“æŸåï¼Œä¸¥æ ¼å®¡æ ¸è¾“å‡ºè´¨é‡
    - å¦‚æœè´¨é‡ä¸è¾¾æ ‡ï¼Œæ˜ç¡®æ‹’ç»å¹¶è¦æ±‚é‡è¯•ï¼Œè¯´æ˜å…·ä½“é—®é¢˜
    - åªæœ‰é€šè¿‡å®¡æ ¸çš„ç»“æœæ‰èƒ½è¿›å…¥ä¸‹ä¸€é˜¶æ®µ
    - æœ€ç»ˆæŠ¥å‘Šå¿…é¡»åŒ…å«æ‰€æœ‰å¿…éœ€ä¿¡æ¯ï¼Œæ ¼å¼æ­£ç¡®ï¼Œå†…å®¹å®Œæ•´
    
    ç°åœ¨å¼€å§‹æ‰§è¡Œï¼Œä¸¥æ ¼æŒ‰ç…§ä¸Šè¿°æµç¨‹å’Œè´¨é‡æ ‡å‡†è¿›è¡Œã€‚
    """
    return prompt


def process_resume(file) -> str:
    """
    å¤„ç†ä¸Šä¼ çš„ç®€å†æ–‡ä»¶ï¼ˆé€‚é… Gradio 6.3.0ï¼‰
    
    Args:
        file: Gradio 6.3.0 æ–‡ä»¶ä¸Šä¼ å¯¹è±¡ï¼Œå¯èƒ½æ˜¯ï¼š
            - str: æ–‡ä»¶è·¯å¾„å­—ç¬¦ä¸²
            - bytes: æ–‡ä»¶å†…å®¹ï¼ˆå­—èŠ‚ï¼‰
            - list: æ–‡ä»¶åˆ—è¡¨ï¼ˆå½“ file_count="multiple" æ—¶ï¼‰
            - None: æœªä¸Šä¼ æ–‡ä»¶
        
    Returns:
        ç”Ÿæˆçš„èŒä¸šè§„åˆ’æŠ¥å‘Šï¼ˆMarkdown æ ¼å¼ï¼‰
    """
    # æ£€æŸ¥æ–‡ä»¶æ˜¯å¦ä¸Šä¼ 
    if file is None:
        return "âŒ **é”™è¯¯**ï¼šè¯·å…ˆä¸Šä¼ ç®€å†æ–‡ä»¶ï¼ˆPDF æ ¼å¼ï¼‰"
    
    # Gradio 6.3.0 æ–‡ä»¶å¤„ç†ï¼šæ”¯æŒå¤šç§ç±»å‹
    file_path = None
    
    # å¤„ç†å­—ç¬¦ä¸²è·¯å¾„ï¼ˆæœ€å¸¸è§çš„æƒ…å†µï¼‰
    if isinstance(file, str):
        file_path = file
    # å¤„ç†æ–‡ä»¶å¯¹è±¡ï¼ˆæœ‰ name å±æ€§ï¼‰
    elif hasattr(file, 'name'):
        file_path = file.name
    # å¤„ç†å­—å…¸æ ¼å¼ï¼ˆæŸäº›æƒ…å†µä¸‹ï¼‰
    elif isinstance(file, dict):
        # å¯èƒ½æ˜¯ {"name": "...", "path": "...", ...} æ ¼å¼
        file_path = file.get('name') or file.get('path')
    # å¤„ç†åˆ—è¡¨ï¼ˆå¤šä¸ªæ–‡ä»¶ï¼‰
    elif isinstance(file, list) and len(file) > 0:
        # å–ç¬¬ä¸€ä¸ªæ–‡ä»¶
        first_file = file[0]
        if isinstance(first_file, str):
            file_path = first_file
        elif hasattr(first_file, 'name'):
            file_path = first_file.name
        elif isinstance(first_file, dict):
            file_path = first_file.get('name') or first_file.get('path')
    # å¤„ç† bytesï¼ˆç›´æ¥æ˜¯æ–‡ä»¶å†…å®¹ï¼‰
    elif isinstance(file, bytes):
        # å¦‚æœæ˜¯å­—èŠ‚æµï¼Œéœ€è¦å…ˆä¿å­˜åˆ°ä¸´æ—¶æ–‡ä»¶
        import tempfile
        temp_file = tempfile.NamedTemporaryFile(delete=False, suffix='.pdf')
        temp_file.write(file)
        temp_file.close()
        file_path = temp_file.name
    else:
        # æœ€åå°è¯•è½¬æ¢ä¸ºå­—ç¬¦ä¸²
        file_path = str(file)
    
    # éªŒè¯æ–‡ä»¶è·¯å¾„
    if not file_path:
        return "âŒ **é”™è¯¯**ï¼šæ— æ³•è·å–æ–‡ä»¶è·¯å¾„ï¼Œè¯·é‡æ–°ä¸Šä¼ æ–‡ä»¶"
    
    # æ£€æŸ¥æ–‡ä»¶æ˜¯å¦å­˜åœ¨
    if not os.path.exists(file_path):
        return f"âŒ **é”™è¯¯**ï¼šæ–‡ä»¶ä¸å­˜åœ¨ - {file_path}"
    
    # æ£€æŸ¥æ–‡ä»¶æ‰©å±•å
    if not file_path.lower().endswith('.pdf'):
        return "âŒ **é”™è¯¯**ï¼šè¯·ä¸Šä¼  PDF æ ¼å¼çš„ç®€å†æ–‡ä»¶"
    
    try:
        # æ„å»º SOP Prompt
        prompt = build_sop_prompt(file_path)
        
        # è°ƒç”¨ manager_agent æ‰§è¡Œä»»åŠ¡
        print(f"ğŸ¤– å¼€å§‹å¤„ç†ç®€å†: {file_path}")
        
        # æ˜¾ç¤ºå¤„ç†ä¸­æç¤º
        result = manager_agent.run(prompt)
        
        # è¿”å›ç»“æœ
        if result:
            # å°è¯•è¯»å–ç”Ÿæˆçš„æŠ¥å‘Šæ–‡ä»¶
            report_path = "my_career_plan_v2.md"
            if os.path.exists(report_path):
                with open(report_path, 'r', encoding='utf-8') as f:
                    report_content = f.read()
                return report_content
            else:
                # å¦‚æœæ²¡æœ‰ç”Ÿæˆæ–‡ä»¶ï¼Œè¿”å› agent çš„æ‰§è¡Œç»“æœ
                return str(result)
        else:
            return "âš ï¸ **è­¦å‘Š**ï¼šAgent æ‰§è¡Œå®Œæˆï¼Œä½†æœªè¿”å›ç»“æœã€‚è¯·æ£€æŸ¥æ§åˆ¶å°è¾“å‡ºã€‚"
            
    except KeyboardInterrupt:
        return "âŒ **é”™è¯¯**ï¼šå¤„ç†è¢«ç”¨æˆ·ä¸­æ–­"
    except Exception as e:
        error_msg = f"âŒ **æ‰§è¡Œé”™è¯¯**ï¼š{str(e)}\n\n**é”™è¯¯ç±»å‹**ï¼š{type(e).__name__}\n\nè¯·æ£€æŸ¥ï¼š\n1. ç¯å¢ƒå˜é‡æ˜¯å¦æ­£ç¡®é…ç½®\n2. API å¯†é’¥æ˜¯å¦æœ‰æ•ˆ\n3. ç½‘ç»œè¿æ¥æ˜¯å¦æ­£å¸¸"
        print(f"é”™è¯¯è¯¦æƒ…: {error_msg}")
        import traceback
        print(f"å®Œæ•´é”™è¯¯å †æ ˆ:\n{traceback.format_exc()}")
        return error_msg


# ==================== åˆ›å»º Gradio ç•Œé¢ ====================

# å®šä¹‰ç•Œé¢ç»„ä»¶
with gr.Blocks(title="å¤š Agent èŒä¸šè§„åˆ’ç³»ç»Ÿ", theme=gr.themes.Soft()) as demo:
    gr.Markdown("""
    # ğŸ¤– å¤š Agent èŒä¸šè§„åˆ’ç³»ç»Ÿ
    
    åŸºäº AI Agent çš„æ™ºèƒ½èŒä¸šè§„åˆ’åŠ©æ‰‹ï¼Œå¸®åŠ©æ‚¨ï¼š
    - ğŸ“Š åˆ†æç®€å†èƒŒæ™¯ï¼Œæ¨èåŠ¡å®çš„ç›®æ ‡å…¬å¸
    - ğŸ” æœç´¢èŒä½æè¿°ï¼ˆJDï¼‰ï¼Œæå–è–ªèµ„å’Œåœ°ç‚¹ä¿¡æ¯
    - ğŸ“š åˆ†ææŠ€èƒ½å·®è·ï¼Œæ¨è GitHub å­¦ä¹ é¡¹ç›®
    - ğŸ“ ç”Ÿæˆå®Œæ•´çš„èŒä¸šè§„åˆ’æŠ¥å‘Š
    
    **ä½¿ç”¨è¯´æ˜**ï¼š
    1. ä¸Šä¼ æ‚¨çš„ç®€å†æ–‡ä»¶ï¼ˆPDF æ ¼å¼ï¼‰
    2. ç‚¹å‡»"å¼€å§‹èŒä¸šè§„åˆ’"æŒ‰é’®
    3. ç­‰å¾…ç³»ç»Ÿåˆ†æï¼ˆå¯èƒ½éœ€è¦å‡ åˆ†é’Ÿï¼‰
    4. æŸ¥çœ‹ç”Ÿæˆçš„èŒä¸šè§„åˆ’æŠ¥å‘Š
    """)
    
    with gr.Row():
        with gr.Column(scale=1):
            file_input = gr.File(
                label="ä¸Šä¼ ç®€å† (Upload Resume)",
                file_types=[".pdf"],
                type="filepath",  # Gradio 6.3.0 æ”¯æŒï¼šfilepath, binary, bytes
                file_count="single"  # æ˜ç¡®æŒ‡å®šå•ä¸ªæ–‡ä»¶
            )
            submit_btn = gr.Button(
                "å¼€å§‹èŒä¸šè§„åˆ’ (Start Planning)",
                variant="primary",
                size="lg"
            )
        
        with gr.Column(scale=2):
            output = gr.Markdown(
                label="èŒä¸šè§„åˆ’æŠ¥å‘Š",
                value="ç­‰å¾…ä¸Šä¼ ç®€å†å¹¶å¼€å§‹åˆ†æ..."
            )
    
    # ç»‘å®šäº‹ä»¶ï¼ˆé€‚é… Gradio 6.3.0ï¼‰
    submit_btn.click(
        fn=process_resume,
        inputs=file_input,
        outputs=output,
        api_name="process_resume",  # API åç§°
        api_visibility="public"    # Gradio 6.x ä½¿ç”¨ api_visibility æ›¿ä»£ show_api
    )
    
    # æ·»åŠ è¯´æ˜
    gr.Markdown("""
    ---
    ### ğŸ“Œ æ³¨æ„äº‹é¡¹
    
    - è¯·ç¡®ä¿ç®€å†æ–‡ä»¶ä¸º PDF æ ¼å¼
    - åˆ†æè¿‡ç¨‹å¯èƒ½éœ€è¦ 2-5 åˆ†é’Ÿï¼Œè¯·è€å¿ƒç­‰å¾…
    - ç”Ÿæˆçš„æŠ¥å‘Šä¼šä¿å­˜ä¸º `my_career_plan_v2.md` æ–‡ä»¶
    - ç³»ç»Ÿä¼šè‡ªåŠ¨è¿›è¡Œè´¨é‡å®¡æ ¸ï¼Œç¡®ä¿è¾“å‡ºä¿¡æ¯çš„å®Œæ•´æ€§å’Œå‡†ç¡®æ€§
    """)


# ==================== å¯åŠ¨åº”ç”¨ ====================
if __name__ == "__main__":
    print("ğŸš€ å¯åŠ¨ Gradio Web åº”ç”¨...")
    print("=" * 60)
    demo.launch(
        server_name="0.0.0.0",  # å…è®¸å¤–éƒ¨è®¿é—®
        server_port=7860,       # é»˜è®¤ç«¯å£
        share=True             # ä¸åˆ›å»ºå…¬å…±é“¾æ¥ï¼ˆå¦‚éœ€åˆ†äº«å¯è®¾ç½®ä¸º Trueï¼‰
    )
